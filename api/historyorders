// api/orders.js

/**
 * 查询历史订单
 * @param {string} token - JWT 授权 Token
 * @returns {Promise<object>} 查询结果对象，包含 message 和 data（订单数组）
 */
export async function fetchOrderHistory(token) {
  const url = 'https://another-mshb.vercel.app/api/historyorders';

  try {
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      }
    });

    if (!response.ok) {
      throw new Error(`HTTP 错误：${response.status}`);
    }

    const result = await response.json();

    // 映射字段名：timestamp -> 订单时间, items -> 交易名称
    const mappedData = result.data.map(order => ({
      id: order.id,
      订单时间: order.timestamp,
      account: order.account,
      交易名称: order.items
    }));

    return {
      message: result.message,
      data: mappedData
    };
  } catch (error) {
    console.error('获取订单历史失败：', error);
    return {
      message: '获取订单历史失败',
      data: []
    };
  }
}
